<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      class Ws {
        dataSend = {
          eventName: "connected",
          data: {},
        };

        dataRecv = {};

        async connect() {
          this.ws = new WebSocket(`ws://${window.location.host}/ws`);

          return new Promise((resolve, reject) => {
            this.ws.onopen = (event) => {
              resolve(this);
            };
          });
        }

        set(eventName, data) {
          this.dataSend.eventName = eventName;
          this.dataSend.data = data;
          return this;
        }

        send() {
          this.ws.send(JSON.stringify(this.dataSend));
        }

        onMessage() {
          this.ws.onmessage((event) => {
            console.log(event);
          });
        }

        onCallback() {}
      }
      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);

      async function main() {
        var ws = new Ws();
        var username = urlParams.get("username");

        if (username.length === 0 || username === "") {
          alert("Invalid Username");
          return;
        }

        ws = await ws.connect();
        ws.set("connected", { userId: username }).send();
      }
      window.addEventListener("DOMContentLoaded", () => {
        main();
      });
    </script>
  </body>
</html>
